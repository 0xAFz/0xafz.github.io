+++
date = '2025-11-03T02:01:18+03:30'
draft = false
hideSummary = true
title = 'ฺฉุงูุด ูพูฺฏ ู ุจูุจูุฏ ุฑุฌุณุชุฑ ุฏุฑ ุจุงุฒโูุง ุดูุชุฑ ุขููุงู'
+++

ุชู ุงู ูพุณุช ูุฎูุงู ุฏุฑููุฑุฏ ุฏูุชุง ุงุฒ ฺุฒุง ฺฉู ุชุงุซุฑ ุฒุงุฏ ุฏุฑ ุจูุชุฑ ุดุฏู latency ุชู ฺฏู ุฏุงุดุชู ุตุญุจุช ฺฉูู  
ู ุงููุง (Qdisc) Queue Discipline
ู Active Queue Management (AQM)  ูุณุชู  

ูุฑุถ ฺฉูุฏ ฺฉู ุฑูุชุฏ ุฏููู ููู ุจฺฏุฑุฏ ู ุฎู ุนุฌูู ุฏุงุฑุฏ ุงูุง ุงุฒ ุดุงูุณ ุจุฏุชูู ู ููุฑ ุฏฺฏู ุชู ุตู ุฌูู ุดูุงุณุช ู ฺฏูุชู ณฐฐ ุชุง ููู ูุฎูุงู ๐คฃ  
ู ุชู ุจุฏุชุฑู ุญุงูุช ุดูุง ุจุงุฏ ุตุจุฑ ฺฉูุฏ ุชุง ููุฑ ุฌูู ุชูุงู ุงูู ณฐฐ ุชุง ููู ุฑู ุฌูุน  ฺฉูู ู ุจุฑู ุชุง ุดูุง ุจุชููุฏ ุฏููู ููู ุจฺฏุฑุฏ

ุงู ุฏุงุณุชุงู ุชู ูพุฑุฏุงุฒุด ูพฺฉุชโ ูู ูุฌูุฏ ุฏุงุฑู  
ุฒูุงู ฺฉู ุดูุง ุชุฑฺฉุจ ุงุฒ ุชุฑุงูฺฉ TCP/UDP ุฏุงุฑุฏุ ุงุฒ ุงููุฌุง ฺฉู TCP ุจู ุดุฏุช ุณุน ูฺฉูู ุจุงูุฑ ุฑู ุชุง ุฏุณุชู ูพุฑ ฺฉูู ุชุง ุจู throughput ุจุงูุง ุจุฑุณู  
ุงูู ุทุฑู UDP ุงุฌุงุฒู ููุณ ฺฉุดุฏู ูู ูพุฏุง ููฺฉูู  

ูุฑุถ ฺฉู ุชู ุฎููู ุฎูุฏุชูู ู ุฑูุชุฑ ุฏุงุฑุฏ  
ุดูุง ุฏุงุฑุฏ ฺฏู ูโุฒูุฏ ู ฺฏู ฺฉู ูโุฒูุฏ  
ุงุฒ ููุน battle-royal ูุซูุง PUBG, CoD, ... ูุณุช  
ุชู ุงู ฺฏูโูุง latency ุงููุช ุฎู ุจุงูุง ุฏุงุฑู  
ููู ฺุฒ ุนุงุฏู ุชุง ููุช ฺฉู ูู ูโุจูุฏ ฺฉู ูุฑฺ ุชุฑ ูโุฒูุฏ ุจู ุงูู ุงฺฉุซุฑ ุชุฑูุงุชูู miss ูุดู ู ุจูุด ุจุฑุฎูุฑุฏ ููฺฉูู  
ุนู ฺู ุงุชูุงู ุงูุชุงุฏูุ ฺุฒ ูุณุชุ ฺฉ ุงุฒ ุงุนุถุง ุฎููู ู ููู ุฒุฏู ุฏุงูููุฏ ๐คฃ  
ู ูพฺฉุชโูุง ุดูุง ฺฉู UDP ุจุงุดู ุชู ุตู ุงูุชุงุฏู ูพุดุช ู ูพฺฉุช ุจุฒุฑฺฏ TCP  
ฺฉู ุชุง ุจุฎูุงุฏ ูพุฑุฏุงุฒุด ุจุดู ุงุตูุง ูพฺฉุช ุดูุง ุจ ุงุฑุฒุด ูโุดู ู ููุช ุจู ุฏุณุช ุณุฑูุฑ ฺฏู ุจุฑุณู ุงูู ุฑู ุจู ุนููุงู miss ุซุจุช ูฺฉูู  
ุจู ุงู ุฏุงุณุชุงู ูฺฏู `bufferbloat`

ุฎุจ ุงู ุณุงุฏู ุชุฑู ุญุงูุช ูพุฑุฏุงุฒุด ูพฺฉุช ุนู `FIFO` ูุณุชุ ุฏููู ุตู ุจุดุชุฑ ูุฏุงุฑู ู ูุฑ ูพฺฉุช ุงูู ุจุงุฏ ุงูู ูพุฑุฏุงุฒุด ูุดู
ฺุฌูุฑ ูุดู ุงู ูุดฺฉู ุฑู ุญู ฺฉุฑุฏุ  
ฺฉ ุงุฒ ฺฉุงุฑโูุง ฺฉู ูโุชููู ุงูุฌุงู ุจุฏู ุงูู ฺฉู ุตู ุฑู ู ููุฏุงุฑ ุจูุชุฑ ูุฏุฑุช ฺฉูู

ุจุฑฺฏุฑุฏู ุจู ููููุง  
ุดูุง ุฏููู ููู ูโุฎูุงุฏ ุจฺฏุฑุฏ ู ููุฑ ุฌูู ฺฏูุชู ตฐฐ ุชุง ููู ูโุฎูุงุฏ ู ุงุฒ ุดุงูุณ ุจุฏุชูู ุดูุง ุฏูุจุงุฑู ูพุดุช ุงู ุดุฎุต ูุณุชุฏ
ฺฉู ุจุง ุฌููู "ูพุงูุตุฏ ุนุฏุฏ ูุงู ุฏุงุฏู ฺฉู ูุงูุง ุฌุงู" ุฌูู ุดูุงุณุช ๐

ุงูุฌุง ููููุง ฺฉู ูุฏุฑุชุด ุจูุชุฑ ุดุฏูุ ุดูุง ูโุชููุฏ ุฎูุดุญุงู ุจุงุดุฏ ฺูู ูุฑุงุฑ ูุณ ุชุง ุดุจ ุตุจุฑ ฺฉูุฏ ๐คฃ  
ููุช ุฏุงุฑู ูููโูุงุฑู ุฏุฑ ูุงุฑูุ ู ฺูุฏ ุชุง (ูุซูุง ณ ุชุง) ุจู ุงูู ุนุฒุฒ ุฌูู ูุฏู  
ู ุจุนุฏุด ูุงุฏ ุณุฑุงุบ ุดูุง ูฺฏู ฺูุฏ ุชุง ูุฎูุงุ ุดูุง ูโฺฏุฏ: ุฏููู  
ุงููู ุฏููู ุจู ุดูุง ูุฏู ู ุดูุง ุฎูุดุญุงู ููููุง ุฑู ุชุฑฺฉ ูโฺฉูุฏ  
ู ุฏุฑ ุงุฏุงูู ุฏูุจุงุฑู ุจุฑูโฺฏุฑุฏู ุจู ุงูู ุดุฎุต ู ูุซูุง ณ ุชุง ููู ุฏฺฏู ุจูุด ูุฏู  

ุฏุฑ ูุงูุน ุฏุงุฑู ุณุน ูฺฉูู ุฏุฑ ูุญุธู ุจู ููู ู ููุฏุงุฑ ููู ุจุฏู  
ุจู ุงู ุฏุงุณุชุงู ูฺฏู `fair queue` ๐๐๐

ุญุงูุง ุฑูุดโูุง ุฏฺฏูโุง ูู ูุณุชุ ุงุฑู ุจุงุฒู ูุณุช  
ุตุจุญ ุฒูุฏ ุฑูุช ููู ุจฺฏุฑุ ูููุฒ ฺุดูุงุช ูพูโฺฉุฑุฏูโุณุชุ ูู ูโุจู ููููุง ูุณุฎู ุฌุฏุฏ ุฒุฏู:  
ุฏฺฏู ู ุตู ูุณุชุ ฺูุฏ ุชุง ุตู ุฏุฑุณุช ฺฉุฑุฏู  
ูุซูุง ุตู ุขูุงููุ ุตู ุจุงููุงูุ ุตู ุฌุงูุจุงุฒุงู ุฌูฺฏ ุฌูุงู ุงููุ ุตู ฺฉุณุง ฺฉู ููู ุณูฺฏฺฉ   ุจุฏูู ฺฉูุฌุฏ ูโุฎูุงู ู ุตู ูุฎุตูุต ุงูุฑุงุฏ ฺฉู "ูพุงุฑุช ุฏุงุฑู ุชู ููููุง" ๐  
ุงุฒ ูุถุง ฺฉุดูุฑุช ุง ุฒูโุณุงูุงุฑู ุง ูุฑุฏโุณุงูุงุฑ (ุจุณุชฺฏ ุฏุงุฑู ฺฉ ุงูู ุฑูุฒ ุฑู ููุฏ ุจุงุดู)ุ ุฎูุงุตู ููููุง ุจุดุชุฑ ุญูุงุณุด ุจู ู ุตู ุฎุงุตู  
ุดูุง ูุฑ ุชู ุงูู ุตู ุฎููุชูุ ูฺฉุฑ ูโฺฉู ุจุฑุฏ ฺฉุฑุฏุ ุฏู ููุฑ ุจุดุชุฑ ุฌูู ูุณุชูุ ูุฑ ฺฉุฏููู ู ุฏููู ููู ูโุฎูุงู  
ุงูุง ุงููโูุฑ ู ููุฑ ูุณุช ฺฉู ุฏุงุฏ ูโุฒูู: "ุฏุงุฏุงุด ูพูุฌุงู ุชุง ููู ุจุฏูุ ูพูุฌุงู ุชุงุงุงุงุงุงุง"  
ููููุง ูู ฺูู ููุงูู ฺฉุดูุฑ ุญฺฉู ูโฺฉููุ ุจุดุชุฑ ุจู ุงูู ุตู ุฎุงุต ุชูุฌู ูโฺฉููุ ูุงุณู   ุฎูุฏุด `priority queue` ุฏุฑุณุช ฺฉุฑุฏู  
ฺฏุงูู ูู ู ููุฑ ูุฑู ุฏุงุฎู ููููุง ู ุจุง ฑฐฐ ุชุง ููู ูุงุฏ ุจุฑูู ุจุฏูู ุงูฺฉู ุชู ุตู ูุงุณู (ุงูุง ูพุงุฑุช ุฏุงุฑู ๐๐๐)  

ูุงูุนุง ุชุง ฺฉ ุชุจุนุถุ ุงุตู ุญุงูุง ฺฉู ุงูุฌูุฑ ุดุฏ ุชู ุชู ููููุง

ุจู ุงู ุฏุงุณุชุงู ูฺฏู `multi queue` ู ุงุฎุฑุง ูู ุชู ฺฉุฑูู 6.17 ู qdisc ุฌุฏุฏ ุจู ุงุณู `dualpi2` ุงุถุงูู ุดุฏู ฺฉู ุฏููุง ููู ุฏุงุณุชุงูู ูพุงุฏู ฺฉุฑุฏู  
ุนู ุฏูุชุง ุตู ุฏุงุฑู  

```
low latency queue (L-queue)  
classic queue (C-queue)  
```
ู ูุญูู ฺฉุงุฑุด ุจุฑ ุงุณุงุณ ููุฏ ECN ุชู ูุฏุฑ IP packet ูุณุชุด  
ููุช ECT(0) ุง Not-ECT ุจุงุดู ูพฺฉุช ุฑู ุจู classic queue ูุฏุงุช ูฺฉูู  
ุงูุง ุงฺฏู ECT(1) ู ูุง CE ุจุงุดู ูพฺฉุช ุฑู ุจู low latency queue ูุฏุงุช ูฺฉูู  
ู low latency queue ุงููุช ุฎู ุจุดุชุฑ ูุณุจุช ุจู classic queue ุฏุงุฑู  
ุนู ุงฺฏุฑ ูพฺฉุช ุจุง ECT(1) ุจุงุฏุ ุงุตูุง ููุฐุงุฑู ุฑู ุฒูู ุจูููู ู ุณุฑุน ูพุฑุฏุงุฒุด ูุดู  

ุญุงูุง ุจุงุฏ ุจุฑู ุณุฑุงุบ AQM ุง Active Queue Management  

ู ุฑูุฒ ุฏฺฏุณุช ู ุดูุง ุงูุฑูุฒ ุดุฏุฏุง ุนุฌูู ุฏุงุฑ ุจู ูุฏุฑ ฺฉู ุจุดุชุฑ ุงุฒ ูุซูุง ฑ ุฏููู   ููโุชูู ุชู ุตู ุจููู  
ู ููููุง ฺฉู ุงูุฑูุฒ ุงููุฏุฏ ุฏุงุฑู ุงุฒ fair queue ุงุณุชูุงุฏู ูฺฉูู  
ูุชุงุณูุงูู ุตู ุดุฏุฏุง ุดููุบู ู ุชุนุฏุงุฏ ุฒุงุฏ ุขุฏู ุฌูู ูุณุชู  
ุงุฒ ุงููุฌุง ฺฉู ููููุง ุฎู ุฏุฑฺฏุฑู ู ุฏุงุฑู ุจู ููุช ููู ูุฑุณููู  
ุดูุง ุงู ูพุดุช ูุดุชุง ูุงุณุงุฏ ู ุฏฺฏู ุฏุฑุช ุดุฏู ุงุฒ ุตู ุฎุงุฑุฌ ูุด ู ูุฑ  

ุจู ุงู ุฏุงุณุชุงู ูฺฏู AQM
ุงูุจุชู ุชู ูพุฑุฏุงุฒุด ูพฺฉุช ุงู ุชู ุนูู ูุชูุงูุชูุ ูพฺฉุช ุงุฒ ุตู ุฎุงุฑุฌ ููุดูุ ุฏุฑ ูุงูุน AQM   ูุฏุงู ุฏุฑุญุงู ุจุฑุฑุณ ุตู ูุณุชุด ุชุง ุจุจูู ุงฺฏู ูพฺฉุช ุจุดุชุฑ ุงุฒ ู ุญุฏ ุชู ุตู ุจูุฏู ุงููู ุฏุฑุงูพ ฺฉูู ฺูู ุฏฺฏู ุงุฑุฒุด ูุฏุงุฑู

ุชู ฺฏููฺฏ ุงฺฉุซุฑุง ุงุฒ UDP ุงุณุชูุงุฏู ูุดู ู ุณุฑูุฑ ุจุฑุงุด ููู ูุณุช ฺฉู ูพฺฉุชโูุง ุฏูู ู ุจู ุชุฑุชุจ ุจุงู  
ูุซูุง ูุฑุถ ฺฉู ุดูุง ุฏุงุฑ ฺฉุงุฑุงฺฉุชุฑ ุฎูุฏุช ุฑู ุชู ฺฏู ุญุฑฺฉุช ูุฏ  
ุงฺฏู ู ูพฺฉุช ุฏุฑ ุจุฑุณู ุง ุงุตูุง ูุฑุณู ููู ูุณุ ฺูู ูพฺฉุช ุจุนุฏ ููุช ูุฑุณู ุณุฑูุฑ ฺฏู ุทุจู ุงูู ูพูุฒุดู ุฑู ุขูพุฏุช ูฺฉูู  
ู ุงฺฏู ูพฺฉุช ุฏูู ุฒูุฏุชุฑ ุจุฑุณู ู ูพฺฉุช ุงูู ูู ุจุนุฏ ู ููุฏุงุฑ ุชุงุฎุฑ ุจุฑุณู  
ุดูุง ุชู ฺฏู ุชูู ูพูุฑุช ูุด ๐คฃ (ุจูุด ูฺฏู rubber-banding)  
ุนู ุฏุงุฑ ุฑุงู ูุฑ ุฑุณุฏ ุจู ููุทู y  
ูู ุจุฑโูโฺฏุฑุฏ ุจู ููุทู x ฺฉู ฺูุฏ ูุญุธู ูพุด ุงููุฌุง ุจูุฏ  
ูพุณ ุจูุชุฑู ุงฺฏู ูพฺฉุช latency ุจุงูุง ุฏุงุฑู ุฏุฑุงูพ ุดู ุชุง ุงูฺฉู ุจู ุฏุณุช ุณุฑูุฑ ุจุฑุณู  

ุชู ฺฉุฑูู ูููฺฉุณ ุงูฺฏูุฑุชูโูุง ูุฎุชูู ุงุฒ AQM ุฏุงุฑู ู ูุนุฑูู ุชุฑูุงุด ุงูุง ูุณุชู: `CoDeL`, `PIE`

ุญุงูุง ุชุฑฺฉุจ ุงูุง ุจุง fair queue ูุชููู ูพุฑุฏุงุฒุด ูพฺฉุช ุฑู ูุงูุนุง ุจูุชุฑ ฺฉูู ู ุงุฒ bufferbloat ุฌููฺฏุฑ ฺฉูู

ุจุงู ฺฉู ุฏุฑููุฑุฏ ุงูฺฏูุฑุชู CoDeL ู ูุญูู ฺฉุงุฑุด ุตุญุจุช ฺฉูู  
ุงู ุงูฺฏูุฑุชู ุฎู ุณุงุฏุณุชุ ุฏููู interval ุฏุงุฑู ู ุฏููู target  
ูพฺฉุชโูุง ฺฉู ุชู ุตู ูุณุชู ุฑู ูุฑ n ฺฉู ูุดู interval ุจุฑุฑุณ ูฺฉูู  
ู ฺฺฉ ูฺฉูู ฺฉู ูุฏุช ุฒูุงู ฺฉู ุงู ูพฺฉุชุง ุชู ุตู ูููุฏู ุจุดุชุฑ ุงุฒ target ูุดุฏู ุจุงุดู  
ุงฺฏุฑ ูพฺฉุชโูุง ุจุดุชุฑ ุงุฒ target ูููุฏู ุจุงุดู ุชู ุตู ุดุฑูุน ูฺฉูู ุจู ุฏุฑุงูพ ฺฉุฑุฏู ุงูู   ูพฺฉุชโูุง

ุญุงูุง ุชุฑฺฉุจ fair queue ู CoDeL ฺฉู ูุชุฌุด ูุดู `fq_codel` ฺุฌูุฑ ูุชููู ุจูููู ฺฉูฺฉ ฺฉููุ

ุชู fair queue ู ฺุฒ ุจู ุงุณู flow ุฏุงุฑู ุฏุฑ ูุงูุน ูุดู ฺฏูุช ู ููุน ุงุฒ ุตู ูุณุชุด
ฺฉู ูพฺฉุชโูุง ููุช ฺฉู ูุงู ูุซูุง ุงฺฏุฑ 1024 ุชุง flow ุฏุงุดุชู ุจุงุดู ุจู ุงู flowูุง ุจุฎุด ูุดู (ุจุง ู ุณุฑ ุงูฺฏูุฑุชู hashing ฺฉู ุฏุงุณุชุงู ุฌุฐุงุจ ุฎูุฏุดู ุฏุงุฑู)  

ูฺฉุชู ุงูู ฺฉู fair queue ูุฑ ุจุงุฑ ุณุน ูฺฉูู ุจู ุงูุฏุงุฒู ูุณุงู ุงุฒ ูุฑ flow ูพฺฉุช ุจุฑุฏุงุฑู ู ูพุฑุฏุงุฒุด ฺฉูู
ุจู ุตูุฑุช ูพุดโูุฑุถ 1514byte ุจุฑูโุฏุงุฑู ุนู ุงูุฏุงุฒู ุงุณุชุงูุฏุงุฑุฏ ูุฑ ูพฺฉุช ุชู ุงูุชุฑูุช ุจู ุงุถุงูู ูุฏุฑ ุณุฎุช ุงูุฒุงุฑ

ุญุงูุง AQM ุงูุงู ฺฉุฌุง ุฏุงุณุชุงููุ ููุช ููุฏ ุฎู ุฒุงุฏู ู fair queue ููุชููู ุจู ููุดูู ุฑุณุฏฺฏ ฺฉูู ู ุณุฑ ูพฺฉุช ูุฑู ุชู ุตู ููููู
ุงูุฌุง CoDeL ูุงุฏ ูุณุท ู ุชู ูุฑ interval ูุงุฏ ุตู ุฑู ุจุฑุฑุณ ูฺฉูู ู ุงฺฏู ูพฺฉุช ุจุดุชุฑ ุงุฒ ุญุฏ target ุชู ุตู ูููุฏู ุฑู ุฏุฑุงูพ ูฺฉูู

ุฎุจ ุจุงู ุจุฑู ู ูฺฏุงู ุจู fq_codel ู ูพุงุฑุงูุชุฑโูุงุด ุชู ฺฉุฑูู ุจูุฏุงุฒู

```bash
tc qdisc replace dev eth0 root fq_codel
```

ุจุง ฺฉุงููุฏ tc ูโุชููุฏ qdisc ุฑู ุชุบุฑ ุจุฏุฏ ู ฺฉุงููฺฏุด ฺฉูุฏ

```bash
root@node0-dc3:~# tc qdisc show dev eth0
qdisc fq_codel 8001: root refcnt 2 limit 10240p flows 1024 quantum 1514 target 5ms interval 100ms memory_limit 32Mb ecn drop_batch 64
```

ููููุทูุฑ ฺฉู ูโุจูุฏ ฺฉุฑูู ู ุณุฑ ููุฏุงุฑ ุฏูุงูุช ุจุฑุง ูุฑ ูพุงุฑุงูุชุฑ ุณุช ูฺฉูู

ุงูุง ูุงูุนุง ฺุทูุฑ ูุดู hit register ุฑู ุชู ฺฏู ุจูุชุฑ ฺฉุฑุฏุ
ุงูุงู ูุฎูุงู ุจู ุงู ุจูพุฑุฏุงุฒู  
ูพุงุฑุงูุชุฑ quantumุ 
ฺุฒ ฺฉู ุนููุง ูโุชููู ุชุงุซุฑ ุฒุงุฏ ุจุฐุงุฑู ุฑู latency

ฺฏูุชู ฺฉู fair queue ูุฑ ุจุงุฑ ุณุน ูฺฉูู ุจู ุงูุฏุงุฒู ูุณุงู ุงุฒ ูุฑ flow ูพฺฉุช ุจุฑุฏุงุฑู ู ูพุฑุฏุงุฒุด ฺฉูู (ุงูฺฏูุฑุชู ฺฉู fq_codel ุงุณุชูุงุฏู ูโฺฉูู ุจุฑุง ุงุณฺฉฺูููฺฏ `Deficit Round Robin` ูุณุชุด)

ูุงุฌุฑุง ููุช ุฌุฐุงุจ ูุดู ฺฉู ูโูููู fq_codel ู ุฌูุฑ ุณููู ุจูุฏ ุฏุงุฑู  
ูุฑ flow ู ุณููู ุฏุงุฑู ู ุงู ุฑู ูพุงุฑุงูุชุฑ quantum ูุดุฎุต ูโฺฉูู  
ุนู ุฒูุงู ฺฉู ููุจุช ู flow ูุดู ฺฉู ุณูููโุด ฺฉุงูู ูุณุช ูุซูุง 1514byte  
ุชุง ุฒูุงู ฺฉู ุณูููโุด ุชููู ูุดุฏู ูโุชููู ูพฺฉุช ุงุฑุณุงู ฺฉูู ู fq_codel ุณูฺ ููโฺฉูู ุฑู flow ุจุนุฏ

ุดูุง ุจู ุงูู ุชุฑโ ูโุฒูุฏ ุงูุง fq_codel ุณูฺ ฺฉุฑุฏู ุฑู ู flow ฺฉู ุณููู ุฒุงุฏ ุฏุงุฑู  
ุงูู ุทุฑูุ ุงูู ุชุบุฑ ูพูุฒุดู ูุฏู ู ุฒูุงู ฺฉู fq_codel ุณูฺ ูโฺฉูู ุจู flow ุดูุง ู ูพฺฉุช ุฑู ุงุฑุณุงู ูโฺฉูู  
ุงู ูพฺฉุช miss ูุดู ู ุชุฑโูุง ุดูุง ุจู ุงูู ุจุฑุฎูุฑุฏ ููโฺฉูู

ุจู ูุนูุง ูุงูุน ฺฉููู ุฏุงุฑู ุฏุฑููุฑุฏ ูฺฉุฑูุซุงูู ู ูุงููุซุงููโูุง ุตุญุจุช ูโฺฉูู  
ุจุงุฏ ฺฉุงุฑ ฺฉูู ฺฉู fq_codel ุจู flowูุง ุฒูุฏุชุฑ ุณูฺ ฺฉูู  

ุจุงุฏ ูพุงุฑุงูุชุฑ quantum ุฑู ุจุฑุง ูพฺฉุชโูุง ฺฏููฺฏ ุจููู ฺฉูู  
ุนุฏุฏ ฺฉู ุจุฑุง ุงู ูพุงุฑุงูุชุฑโูุง ุณุช ูุดู ฺุฒ ุซุงุจุช ูุณุช ู ุจุณุชู ุจู ุดุฑุงุท ููฺฉูู   ูุชูุงูุช ุจุงุดู
ุงูุง ูุซูุง ุจุงู quantum ุฑู ุจุฐุงุฑู ุฑู 300byte

```bash
root@node0-dc3:~# tc qdisc replace dev eth0 root fq_codel quantum 300

root@node0-dc3:~# tc qdisc show dev eth0
qdisc fq_codel 8001: root refcnt 2 limit 10240p flows 1024 quantum 300 target 5ms interval 100ms memory_limit 32Mb ecn drop_batch 64
```

ุฎุจ ุงุชูุงู ฺฉู ุงูุงู ูููุชู ฺูุ  
ุดูุง ุจู ุงูู ุชุฑ ูโุฒูุฏุ ู ฺูุฏ ุชุง ูพฺฉุช ูุซูุง 60byte ูุฑุณุชุงุฏู ูโุดู  
ฺูู ุฏฺฏู 300byte ุฒูุฏุชุฑ ุชุงฺ ูุดู fq_codel ูพฺฉุช ุฑู ุณุฑุน ุชุฑ ุงุฑุณุงู ูฺฉูู  
ู ุชู ููู ูุฏุช ุฒูุงู ฺฉู ุณู ุดุฏู ุชุฑ ููุช ุจู ุณุฑูุฑ ฺฏู ูโุฑุณู hit ุซุจุช ูุดู ู   ุงูู ฺฉู ูุดู
ุจุง ุงู ฺฉุงุฑ ูุง flow switching ุฑู ุณุฑุน ุชุฑ ฺฉุฑุฏู ู fq_codel ุฏฺฏู ุณุฑุน ุชุฑ ุจู   flowโูุง switch ูโฺฉูู

ุงู ุฑู ุจุง 1ุ 2 ู 4 ฺฉูุงูุช ุชุณุช ฺฉุฑุฏู  
ุฏุฑ ููู ุญุงูุชโูุง quantum 300 ุจูุชุฑ ุงุฒ 1514 ุจูุฏ  
ุญุช ุจุง ฺฉ ฺฉูุงูุช! ุนู ูุดฺฉู ููุท ุฑูุงุจุช ุจู flowโูุง ูุณุช  
ุจุดุชุฑ ุชุงุซุฑ ุงูู ฺฉู ู flow ูโุชููู ุชุง ููุช ฺฉู ุณููู ุฏุงุฑู ูพฺฉุช dequeue ฺฉูู

ุชู ฺฉุฏ ฺู ุงุชูุงู ูโุงูุชูุ
[github.com/torvalds/linux/net/sched/sch_fq_codel.c#L299](https://github.com/torvalds/linux/blob/ba36dd5ee6fd4643ebbf6ee6eefcecf0b07e35c7/net/sched/sch_fq_codel.c#L299)

ุจุจูุฏ ุงู ุฎุท ฺฉูุฏู:
```c
if (flow->deficit <= 0) {
    flow->deficit += q->quantum;
    list_move_tail(&flow->flowchain, &q->old_flows);
    goto begin;
}
```
ู ุจุนุฏ ูพุงูโุชุฑ:
```c
flow->deficit -= qdisc_pkt_len(skb);
```

ุงู ุนู:  
ูุฑ flow ู `deficit` ุฏุงุฑู (ูุซู ุณููู)  
ููุช ูุฑุงุฑู `dequeue` ฺฉููุ ุงฺฏู `deficit <= 0` ุจูุฏุ ู ุดุงุฑฺ ุฌุฏุฏ ุงุฒ quantum ูโฺฏุฑู
ุชุง ููุช ฺฉู `deficit > 0` ุจุงุดูุ ูโุชููู ูพฺฉุช ุจูุฑุณุชู  
ูุฑ ูพฺฉุช ฺฉู ูโูุฑุณุชูุ deficit ุจู ุงูุฏุงุฒู ุทูู ูพฺฉุช ฺฉู ูโุดู  
ููุช deficit ููู ุดุฏุ flow ูุนูุงู ูุชููู ูโุดู ู ููุจุช ุจุนุฏ flowูุง ูโุฑุณู  

ูุฑุถ ฺฉูู `quantum = 1514`  
ุงู flow ุดุฑูุน ูโฺฉูู ูพฺฉุชโูุงุด ุฑู dequeue ฺฉุฑุฏู  
ูุฑ ูพฺฉุช ถฐ ุจุงุชู  
ุจุนุฏ ุงุฒ ุฏู ูพฺฉุชุ `deficit = 1514 - (60 + 60) = 1394`  
ูููุฒ ฺฉู ุณููู ุฏุงุฑูุ ูพุณ fq_codel ุชุง ููุช deficit ูุซุจุช ุจุงุดู ุจู dequeue ุงุฒ   ูููู flow ุงุฏุงูู ูุฏู ู ููุท ููุช deficit ุชููู ุจุดู flow ุฑู ุจู ุงูุชูุง ุตู ููุชูู ูโฺฉูู  
ุนู ูููู flow ูพุดุช ุณุฑ ูู dequeue ูโฺฉูู ุชุง deficit ุชููู ุดู (ุจู ุตูุฑ ุจุฑุณู)ุ ุง ุตูุด ุฎุงู ุดู `(!skb)`.

ูพุณ ุจููุ quantum ุจุฒุฑฺฏ ุนู batching ุจุฒุฑฺฏโุชุฑ  
ู ุชู workloads ุจุง ูพฺฉุชโูุง ฺฉูฺฺฉ (ูุซู ฺฏู)ุ ุงู ุนู:

ู flow ูโุชููู ฺูุฏ ุฏู ูพฺฉุช ูพุดุชโุณุฑูู ุจูุฑุณุชู ูุจู ุงุฒ ุงูฺฉู ููุจุช ุจูู ุจุฑุณู  
ุฏุฑ ูุชุฌู latency ูุญุธูโุง (queue-to-wire delay) ุจุฑุง ุจูู flowูุง ุจุฏุชุฑ ูโุดู  

ุญุงูุง ููุช `quantum = 300` ุจุงุดู:  
ุงู flow ููุท ูโุชููู ุญุฏูุฏ ต ุชุง ูพฺฉุช ฺฉูฺฺฉ ถฐ ุจุงุช ุจูุฑุณุชูุ ุจุนุฏ deficitุด ุชููู ูโุดู  
ุจุนุฏุด ูโุฑู ุชู ุตู  
ุนู ุณูฺ ุจู flowูุง ุณุฑุนโุชุฑู fairness ุจูุชุฑุ jitter ฺฉูุชุฑุ batching ฺฉูุชุฑ  

ุงูุง ฺูู ุณูฺ ุฒุงุฏ ูโุดูุ CPU overhead ฺฉู ูโุฑู ุจุงูุง (ฺูู context switch ุจู flow queues ุจุดุชุฑู)

ุชู ฺฉุฏ fq_codel ุตุจุฑ ููโฺฉูู ุชุง ุจุงุชโูุง ุฌูุน ุดู  
ูฺ "wait for quantum fill" ุงุชูุงู ููโุงูุชู  
ููุท ุชุง ููุช ฺฉู ูพฺฉุช ุขูุงุฏู dequeue ุจุงุดูุ ูููู ูุญุธู ุงุฑุณุงู ูโฺฉูู  
ุงูุง ฺูู deficit ูููุฒ ูุซุจุชูุ ูููู flow ุญู ุฏุงุฑู ุจูุงูุงุตูู ูพฺฉุช ุจุนุฏ ุฎูุฏุด ุฑู ุจุฏู  
ุนู ุงุฒ ุฏุฏ ุฑูุชุงุฑุ ุดุจู ุงู ูโุดู ฺฉู ุงูฺฏุงุฑ batching ุฏุงุฑู  
ุฏุฑ ูุงูุน quantum ุจุงูุง ุฏุฑ ุชุฑุงูฺฉ real-time ุจุงุนุซ pseudo-batching ูโุดู  

ุชู ุงู ูพุณุช ุฏุฑููุฑุฏ fq_codel, AQM, Qdisc ุตุญุจุช ฺฉุฑุฏู ู ูุชูุฌู ุดุฏู ฺฉู ูพุงุฑุงูุชุฑ quantum ุชุงุซุฑ ุฒุงุฏ ูโุชููู ุฑู latency ุจุฐุงุฑู

ุงูุฏูุงุฑู ฺฉู ุงุฒ ฺฏู ุฒุฏู ูุฐุช ุจุจุฑุฏ.
